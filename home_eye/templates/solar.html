(% extends 'base.html' %)
(% block title %) solar (% endblock %)

(% block head %)
<script src="https://www.gstatic.com/charts/loader.js"></script>
  <script>
    google.charts.load('current', {packages: ['corechart']});
    google.charts.setOnLoadCallback(drawChart);

    function sum(arr){
      var sum = 0;
      for(i=0; i < arr.length; i++){
        sum += arr[i];
      }
      return sum;
    }

    var trend = (( history.values|safe ));
    var sum = sum(trend);
    var avg = sum/trend.length;

    function drawChart() {
      var data = new google.visualization.DataTable();
      data.addColumn('string', 'Types');
      data.addColumn('number', 'Wh');
      data.addColumn({type: 'string', role: 'annotation'});
      data.addColumn({type: 'string', role: 'style'});
      data.addRows([
        ['Today', ((solar.energy.value|safe)), '' +((solar.energy.display_value|safe)), "color:#6155a6" ],
        ['7 day avg', avg, '' +Math.round(avg), "color:#a685e2"]]);

      var options = {
        legend: {position:'none'},
        cssClassName: {}
      };
      var chart = new google.visualization.BarChart(document.getElementById('myPieChart'));
      chart.draw(data, options);
    }
  </script>
(% endblock %)

(% block nav_title %) (( back_to('/') )) (% endblock %)

(% block content %)

(( heading('Solar panel') ))

<div class="container">

  (( solar_submenu(request.url, 'energy/production') ))

  <div class="container my-box my-rounded bg-white plain_text">
      <div class="row plain_text my-row">
        <div class="col-5">Power</div>
        <div class="col-7">(( solar.power.display_value )) (( solar.power.unit ))</div>
      </div>
      <div class="row plain_text my-row">
        <div class="col-5">Energy</div>
        <div class="col-7">(( solar.energy.display_value )) (( solar.energy.unit ))</div>
      </div>
      <div class="row plain_text my-row">
        <div class="col-5">Registered</div>
        <div class="col-7">(( solar.updated.display_value ))</div>
      </div>
  </div>

  <div class="container bg-white my-box my-rounded">
    <div id="myPieChart" class="plain_text"/>
  </div>
</div>

(% endblock %)